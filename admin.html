<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BossTimer Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gray-100 min-h-screen font-sans">

  <!-- Header -->
  <header class="bg-gray-800 text-white shadow-sm p-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold flex items-center">
      <i data-feather="settings" class="w-6 h-6 mr-2"></i>
      Admin Panel
    </h1>
    <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded">Logout</button>
  </header>

  <!-- Main -->
  <main class="max-w-5xl mx-auto p-6 space-y-8">

    <!-- Servers Management -->
    <section class="bg-white shadow rounded-xl p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Servers</h2>
        <button id="addServerBtn" class="bg-primary-500 hover:bg-primary-600 px-4 py-2 rounded text-white">Add Server</button>
      </div>
      <div id="serverList" class="space-y-2"></div>
    </section>

    <!-- Admins Management -->
    <section class="bg-white shadow rounded-xl p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Admins</h2>
        <button id="addAdminBtn" class="bg-primary-500 hover:bg-primary-600 px-4 py-2 rounded text-white">Add Admin</button>
      </div>
      <div id="adminList" class="space-y-2"></div>
    </section>

  </main>

  <!-- Modals -->

  <!-- Add Server Modal -->
  <div id="addServerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
    <div class="bg-gray-800 p-6 rounded-xl w-full max-w-md">
      <h3 class="text-xl font-bold mb-4 text-white">Add Server</h3>
      <input id="serverNameInput" type="text" placeholder="Server Name" class="w-full px-4 py-2 mb-3 rounded bg-gray-700 text-white border border-gray-600">
      <input id="serverPasswordInput" type="text" placeholder="Server Password (optional)" class="w-full px-4 py-2 mb-3 rounded bg-gray-700 text-white border border-gray-600">
      <div class="flex justify-end space-x-3">
        <button id="cancelAddServer" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-white">Cancel</button>
        <button id="saveAddServer" class="px-4 py-2 bg-primary-500 hover:bg-primary-600 rounded text-white">Save</button>
      </div>
    </div>
  </div>

  <!-- Add Admin Modal -->
  <div id="addAdminModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
    <div class="bg-gray-800 p-6 rounded-xl w-full max-w-md">
      <h3 class="text-xl font-bold mb-4 text-white">Add Admin</h3>
      <input id="adminNameInput" type="text" placeholder="Player Name" class="w-full px-4 py-2 mb-3 rounded bg-gray-700 text-white border border-gray-600">
      <select id="adminServerSelect" class="w-full px-4 py-2 mb-3 rounded bg-gray-700 text-white border border-gray-600"></select>
      <div class="flex justify-end space-x-3">
        <button id="cancelAddAdmin" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-white">Cancel</button>
        <button id="saveAddAdmin" class="px-4 py-2 bg-primary-500 hover:bg-primary-600 rounded text-white">Save</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script type="module">
    feather.replace();

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { getFirestore, collection, getDocs, setDoc, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCcZa-fnSwdD36rB_DAR-SSfFlzH2fqcPc",
      authDomain: "lordninetimer.firebaseapp.com",
      projectId: "lordninetimer",
      storageBucket: "lordninetimer.firebasestorage.app",
      messagingSenderId: "462837939255",
      appId: "1:462837939255:web:dee141d630d5d9b94a53b2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Elements
    const serverList = document.getElementById('serverList');
    const adminList = document.getElementById('adminList');
    const addServerModal = document.getElementById('addServerModal');
    const addAdminModal = document.getElementById('addAdminModal');

    // Load Servers
    async function loadServers(){
      serverList.innerHTML='';
      const serversSnapshot = await getDocs(collection(db,'servers'));
      serversSnapshot.forEach(docSnap=>{
        const s = docSnap.data();
        const div = document.createElement('div');
        div.className='flex justify-between items-center bg-gray-700 text-white p-2 rounded';
        div.innerHTML=`<span>${s.name}</span>
          <span>${s.password?'●●●':'No password'}</span>
          <button data-id="${docSnap.id}" class="deleteServer px-2 py-1 bg-red-500 rounded text-white">Delete</button>`;
        serverList.appendChild(div);
      });
      document.querySelectorAll('.deleteServer').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          if(confirm('Delete this server?')){
            await deleteDoc(doc(db,'servers',btn.dataset.id));
            loadServers();
          }
        });
      });
    }
    loadServers();

    // Load Admins
    async function loadAdmins(){
      adminList.innerHTML='';
      const adminsSnapshot = await getDocs(collection(db,'admins'));
      adminsSnapshot.forEach(docSnap=>{
        const a = docSnap.data();
        const div = document.createElement('div');
        div.className='flex justify-between items-center bg-gray-700 text-white p-2 rounded';
        div.innerHTML=`<span>${a.name}</span><span>${a.server}</span>
          <button data-id="${docSnap.id}" class="deleteAdmin px-2 py-1 bg-red-500 rounded text-white">Delete</button>`;
        adminList.appendChild(div);
      });
      document.querySelectorAll('.deleteAdmin').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          if(confirm('Remove this admin?')){
            await deleteDoc(doc(db,'admins',btn.dataset.id));
            loadAdmins();
          }
        });
      });
    }
    loadAdmins();

    // Add Server
    document.getElementById('addServerBtn').addEventListener('click', ()=>addServerModal.classList.remove('hidden'));
    document.getElementById('cancelAddServer').addEventListener('click', ()=>addServerModal.classList.add('hidden'));
    document.getElementById('saveAddServer').addEventListener('click', async ()=>{
      const name=document.getElementById('serverNameInput').value.trim();
      const password=document.getElementById('serverPasswordInput').value.trim();
      if(name){
        const id=name.replace(/\s+/g,'_').toLowerCase();
        await setDoc(doc(db,'servers',id),{name,password});
        addServerModal.classList.add('hidden');
        loadServers();
      }
    });

    // Add Admin
    document.getElementById('addAdminBtn').addEventListener('click', async ()=>{
      addAdminModal.classList.remove('hidden');
      const serverSelect = document.getElementById('adminServerSelect');
      serverSelect.innerHTML='';
      const serversSnapshot = await getDocs(collection(db,'servers'));
      serversSnapshot.forEach(docSnap=>{
        const s = docSnap.data();
        const opt = document.createElement('option');
        opt.value=docSnap.id;
        opt.textContent=s.name;
        serverSelect.appendChild(opt);
      });
    });
    document.getElementById('cancelAddAdmin').addEventListener('click', ()=>addAdminModal.classList.add('hidden'));
    document.getElementById('saveAddAdmin').addEventListener('click', async ()=>{
      const name=document.getElementById('adminNameInput').value.trim();
      const server=document.getElementById('adminServerSelect').value;
      if(name && server){
        const id=name.replace(/\s+/g,'_').toLowerCase();
        await setDoc(doc(db,'admins',id),{name,server});
        addAdminModal.classList.add('hidden');
        loadAdmins();
      }
    });

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', ()=>location.href='index.html');

  </script>

</body>
</html>