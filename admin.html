<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BossTimer Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // --- Firebase config ---
    const firebaseConfig = {
      apiKey: "AIzaSyCcZa-fnSwdD36rB_DAR-SSfFlzH2fqcPc",
      authDomain: "lordninetimer.firebaseapp.com",
      projectId: "lordninetimer",
      storageBucket: "lordninetimer.firebasestorage.app",
      messagingSenderId: "462837939255",
      appId: "1:462837939255:web:dee141d630d5d9b94a53b2"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</head>

<body class="bg-gray-50 font-sans">
  <header class="bg-gray-800 text-white p-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold flex items-center"><i data-feather="shield" class="w-6 h-6 mr-2"></i>Admin Panel</h1>
    <button id="logoutBtn" class="px-3 py-2 bg-red-500 rounded hover:bg-red-600">Logout</button>
  </header>

  <main class="max-w-6xl mx-auto mt-6 p-4 grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- Users Management -->
    <section class="bg-white rounded-xl shadow p-4">
      <h2 class="text-xl font-semibold mb-4 flex items-center"><i data-feather="users" class="w-5 h-5 mr-2"></i>Users</h2>
      <div id="usersContainer" class="space-y-2 max-h-96 overflow-y-auto"></div>
    </section>

    <!-- Servers Management -->
    <section class="bg-white rounded-xl shadow p-4">
      <h2 class="text-xl font-semibold mb-4 flex items-center"><i data-feather="server" class="w-5 h-5 mr-2"></i>Servers</h2>
      <div id="serversContainer" class="space-y-2 max-h-96 overflow-y-auto"></div>
      <button id="addServerBtn" class="mt-3 px-4 py-2 bg-primary-500 text-white rounded hover:bg-primary-600">Add Server</button>
    </section>
  </main>

  <script>
    feather.replace();
  </script>

<script>
  const usersContainer = document.getElementById('usersContainer');
  const serversContainer = document.getElementById('serversContainer');

  // --- Load Users ---
  async function loadUsers() {
    usersContainer.innerHTML = '';
    const usersSnap = await db.collection('users').get();
    usersSnap.forEach(doc => {
      const user = doc.data();
      const div = document.createElement('div');
      div.className = 'flex justify-between items-center bg-gray-100 p-2 rounded';
      div.innerHTML = `
        <span>${user.playerName} [${user.guild}] - ${user.server}</span>
        <div class="flex space-x-2">
          <button class="px-2 py-1 bg-green-500 text-white rounded assignAdminBtn">${user.isAdmin ? 'Revoke Admin' : 'Make Admin'}</button>
          <button class="px-2 py-1 bg-red-500 text-white rounded removeUserBtn">Remove</button>
        </div>
      `;
      // Assign/revoke admin
      div.querySelector('.assignAdminBtn').addEventListener('click', async () => {
        await db.collection('users').doc(doc.id).update({isAdmin: !user.isAdmin});
        loadUsers();
      });
      // Remove user
      div.querySelector('.removeUserBtn').addEventListener('click', async () => {
        if(confirm('Remove this user?')) {
          await db.collection('users').doc(doc.id).delete();
          loadUsers();
        }
      });
      usersContainer.appendChild(div);
    });
  }

  // --- Load Servers ---
  async function loadServers() {
    serversContainer.innerHTML = '';
    const serversSnap = await db.collection('servers').get();
    serversSnap.forEach(doc => {
      const server = doc.data();
      const div = document.createElement('div');
      div.className = 'flex justify-between items-center bg-gray-100 p-2 rounded';
      div.innerHTML = `
        <span>${server.name}</span>
        <div class="flex space-x-2">
          <input type="text" class="px-2 py-1 border rounded passwordInput" placeholder="Password" value="${server.password || ''}" />
          <button class="px-2 py-1 bg-blue-500 text-white rounded saveServerBtn">Save</button>
          <button class="px-2 py-1 bg-red-500 text-white rounded removeServerBtn">Remove</button>
        </div>
      `;
      // Save server password
      div.querySelector('.saveServerBtn').addEventListener('click', async () => {
        const pwd = div.querySelector('.passwordInput').value.trim();
        await db.collection('servers').doc(doc.id).update({password: pwd});
        alert('Saved!');
      });
      // Remove server
      div.querySelector('.removeServerBtn').addEventListener('click', async () => {
        if(confirm('Remove this server?')) {
          await db.collection('servers').doc(doc.id).delete();
          loadServers();
        }
      });
      serversContainer.appendChild(div);
    });
  }

  // --- Add Server Button ---
  document.getElementById('addServerBtn').addEventListener('click', async () => {
    const name = prompt('Enter server name:');
    if(!name) return;
    await db.collection('servers').add({name, password: ''});
    loadServers();
  });

  // --- Initial Load ---
  loadUsers();
  loadServers();

  // --- Logout ---
  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('bossTimerUser');
    location.href = 'index.html';
  });
</script>
</body>
</html>