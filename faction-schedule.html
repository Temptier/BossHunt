<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChronoBoss Commander</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            active: '#10B981',
            upcoming: '#F59E0B',
            scheduled: '#3B82F6',
            empty: '#F3F4F6',
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      },
    };
  </script>

  <style>
    .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .boss-column { position: sticky; left: 0; z-index: 10; background: white; box-shadow: 2px 0 5px rgba(0,0,0,0.1); }
    .status-active { background-color: #10B981; color: white; }
    .status-upcoming { background-color: #F59E0B; color: #1F2937; }
    .status-scheduled { background-color: #3B82F6; color: white; }
    .status-empty { background-color: #F3F4F6; color: #6B7280; }
    .cell-hover:hover { transform: scale(1.02); transition: transform 0.2s ease; z-index: 5; }
  </style>
</head>

<body class="font-inter bg-gray-50 min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col sm:flex-row justify-between items-center py-6">
        <div class="text-center sm:text-left mb-4 sm:mb-0">
          <h1 class="text-3xl font-bold text-gray-900 flex items-center justify-center sm:justify-start">
            <i data-feather="clock" class="w-8 h-8 mr-3 text-primary"></i>
            Boss Timer Tracker
          </h1>
          <p class="text-gray-600 mt-2">Never miss a boss spawn again!</p>
        </div>
        <div class="flex space-x-3">
          <div class="bg-gray-100 rounded-lg p-1 flex">
            <span class="px-3 py-2 rounded-md text-gray-900 font-medium flex items-center" id="userServerDisplay">Server</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
      <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-200">
        <div class="flex items-center">
          <div class="w-3 h-3 rounded-full bg-active mr-3"></div>
          <span class="text-sm font-medium text-gray-700">Active Now</span>
        </div>
        <div class="text-2xl font-bold text-gray-900 mt-2" id="activeCount">0</div>
      </div>
      <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-200">
        <div class="flex items-center">
          <div class="w-3 h-3 rounded-full bg-upcoming mr-3"></div>
          <span class="text-sm font-medium text-gray-700">Upcoming</span>
        </div>
        <div class="text-2xl font-bold text-gray-900 mt-2" id="upcomingCount">0</div>
      </div>
      <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-200">
        <div class="flex items-center">
          <div class="w-3 h-3 rounded-full bg-scheduled mr-3"></div>
          <span class="text-sm font-medium text-gray-700">Scheduled</span>
        </div>
        <div class="text-2xl font-bold text-gray-900 mt-2" id="scheduledCount">0</div>
      </div>
      <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-200">
        <div class="flex items-center">
          <div class="w-3 h-3 rounded-full bg-empty mr-3"></div>
          <span class="text-sm font-medium text-gray-700">Empty Slots</span>
        </div>
        <div class="text-2xl font-bold text-gray-900 mt-2" id="emptyCount">0</div>
      </div>
    </div>

    <!-- Boss Table -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden table-container">
      <table class="w-full border-collapse">
        <thead class="bg-gray-50">
          <tr>
            <th class="boss-column w-48 px-6 py-4 text-left text-sm font-semibold text-gray-900 border-r border-gray-200">Boss Name</th>
            <th class="px-6 py-4 text-center text-sm font-semibold text-gray-900">Monday</th>
            <th class="px-6 py-4 text-center text-sm font-semibold text-gray-900">Tuesday</th>
            <th class="px-6 py-4 text-center text-sm font-semibold text-gray-900">Wednesday</th>
            <th class="px-6 py-4 text-center text-sm font-semibold text-gray-900">Thursday</th>
            <th class="px-6 py-4 text-center text-sm font-semibold text-gray-900">Friday</th>
          </tr>
        </thead>
        <tbody id="bossTableBody" class="divide-y divide-gray-200"></tbody>
      </table>
    </div>

    <!-- Timers -->
    <div id="timerContainer" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"></div>

    <!-- Legend -->
    <div class="mt-6 flex flex-wrap justify-center gap-4 text-sm max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center"><div class="w-4 h-4 rounded bg-active mr-2"></div><span>Active / Spawned</span></div>
      <div class="flex items-center"><div class="w-4 h-4 rounded bg-upcoming mr-2"></div><span>Upcoming (within 1 hour)</span></div>
      <div class="flex items-center"><div class="w-4 h-4 rounded bg-scheduled mr-2"></div><span>Scheduled</span></div>
      <div class="flex items-center"><div class="w-4 h-4 rounded bg-empty mr-2 border border-gray-300"></div><span>Empty / No Schedule</span></div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t border-gray-200 mt-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex flex-col md:flex-row justify-between items-center">
      <div class="text-gray-600 text-sm mb-4 md:mb-0">
        Â© 2024 ChronoBoss Commander. Track like a pro!
      </div>
      <div class="flex space-x-4">
        <button class="text-gray-400 hover:text-gray-600 transition-colors"><i data-feather="settings"></i></button>
        <button class="text-gray-400 hover:text-gray-600 transition-colors"><i data-feather="help-circle"></i></button>
        <button class="text-gray-400 hover:text-gray-600 transition-colors"><i data-feather="bell"></i></button>
      </div>
    </div>
  </footer>

  <!-- JS Logic -->
  <script>
feather.replace();

// ===== User Server Selection =====
let userServer = localStorage.getItem('userServer');
if(!userServer){
  userServer = prompt('Select your server: Server1, Server2, Server3');
  localStorage.setItem('userServer', userServer);
}
document.getElementById('userServerDisplay').textContent = userServer;

// ===== Sample Boss Data =====
const bossData = [
  {name: 'Ancient Dragon', schedule:[
    {day:'Monday', time:'08:30 AM', guild:'DragonSlayers', server:'Server1'},
    {day:'Wednesday', time:'12:00 PM', guild:'DragonSlayers', server:'Server1'}
  ]},
  {name: 'Venatus', schedule:[
    {day:'Tuesday', time:'11:00 AM', guild:'Venators', server:'Server2'},
    {day:'Thursday', time:'03:30 PM', guild:'Venators', server:'Server2'}
  ]}
];

// ===== Load active timers =====
let activeTimers = JSON.parse(localStorage.getItem('activeTimers')) || {};
if(!activeTimers[userServer]) activeTimers[userServer]={};

// ===== Populate table =====
const tbody = document.getElementById('bossTableBody');
tbody.innerHTML='';

bossData.forEach(boss=>{
  const tr = document.createElement('tr');
  const tdBoss = document.createElement('td');
  tdBoss.className='boss-column px-6 py-4 font-medium text-gray-900 border-r border-gray-200';
  tdBoss.textContent = boss.name;
  tr.appendChild(tdBoss);

  const days = ['Monday','Tuesday','Wednesday','Thursday','Friday'];
  days.forEach(day=>{
    const td = document.createElement('td');
    td.className='px-6 py-4 text-center';
    const scheds = boss.schedule.filter(s=>s.day===day && s.server===userServer);
    if(scheds.length>0){
      td.innerHTML = scheds.map(s=>{
        const key = boss.name + '_' + day + '_' + s.time;
        if(!activeTimers[userServer][key]){
          activeTimers[userServer][key] = {boss: boss.name, endTime: s.time, guild: s.guild, notified:false};
        }
        return `<div class="status-scheduled rounded-lg p-2 cell-hover">${s.time} - ${s.guild}</div>`;
      }).join('<br>');
    } else {
      td.innerHTML='<div class="status-empty rounded-lg p-2 cell-hover">-</div>';
    }
    tr.appendChild(td);
  });
  tbody.appendChild(tr);
});

localStorage.setItem('activeTimers', JSON.stringify(activeTimers));

// ===== Timer Rendering =====
const timerContainer = document.getElementById('timerContainer');

function renderTimers(){
  timerContainer.innerHTML='';
  const now = new Date();
  let activeCount=0, upcomingCount=0, scheduledCount=0;

  Object.keys(activeTimers[userServer]).forEach(key=>{
    const t = activeTimers[userServer][key];
    const div = document.createElement('div');
    div.className='bg-gray-200 p-2 mb-2 rounded flex justify-between items-center';

    const end = new Date();
    const [time, meridiem] = t.endTime.split(' ');
    let [h,m] = time.split(':').map(Number);
    if(meridiem==='PM' && h<12) h+=12;
    if(meridiem==='AM' && h===12) h=0;
    end.setHours(h, m,0,0);

    let diff = (end-now)/1000;
    let status='scheduled';
    if(diff>0 && diff<=3600) status='upcoming';
    if(diff<=0) status='active';

    if(status==='active') activeCount++;
    if(status==='upcoming') upcomingCount++;
    if(status==='scheduled') scheduledCount++;

    const hours = Math.floor(diff/3600);
    const mins = Math.floor((diff%3600)/60);
    const secs = Math.floor(diff%60);
    const timeStr = diff>0 ? `${hours.toString().padStart(2,'0')}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}` : '00:00:00';

    div.innerHTML = `<span>${t.boss} - ${t.guild} | ${timeStr}</span>
                     <button class="px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600">Stop</button>`;

    div.querySelector('button').onclick=()=>{
      delete activeTimers[userServer][key];
      localStorage.setItem('activeTimers', JSON.stringify(activeTimers));
      renderTimers();
    };

    timerContainer.appendChild(div);

    // Notification 10 mins before
    if(diff<=600 && !t.notified){
      t.notified=true;
      localStorage.setItem('activeTimers', JSON.stringify(activeTimers));
      if(Notification.permission==='granted'){
        new Notification(`${t.boss} spawns in 10 minutes!`);
      } else {
        console.log(`Notification: ${t.boss} spawns in 10 minutes!`);
      }
    }
  });

  document.getElementById('activeCount').textContent=activeCount;
  document.getElementById('upcomingCount').textContent=upcomingCount;
  document.getElementById('scheduledCount').textContent=scheduledCount;
}

renderTimers();
setInterval(renderTimers, 1000);

// ===== Request Notification Permission =====
if(Notification.permission!=='granted') Notification.requestPermission();
</script>

</body>
</html>